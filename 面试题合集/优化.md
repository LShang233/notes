# 一、加载性能

1.保留首屏渲染的必要JS、CSS资源，非首屏资源进行懒加载。通过谷歌开发工具的覆盖率检查

2.网页资源控制在14k以内，因为TCP 慢启动第一次最多有14kb资源传输

3.对关键资源进行预加载，预加载字体文件

4.网页资源进行压缩，使用最新的压缩算法br对文本类资源进行压缩，对图片进行压缩

5.配置HTTP缓存和PWA

6.静态资源配置CDN

7.使用HTTP2：多路复用和请求头压缩，提升下载速度，服务器推送资源。

8.自适应服务，根据不同的网络环境、设备类型渲染不同的资源，

9.使用preconnect和dns-prefetch尽早建立连接。

# 二、渲染性能

1.使用SSR：提升首屏渲染，配置预渲染，优化TTFB时间

2.构建时提取首屏css到内联html

3.配置async或者defer属性在会影响渲染的script标签上，懒加载第三方脚本

4.避免频繁操作DOM引起的回流，避免动态加载首屏资源。

5.合理利用浏览器预解析和优先级，如第二屏的图片可以不做懒加载，也不影响首屏

6.减少使用闭包，延长GC时间阻塞主线程。因为浏览器在主线程执行JS脚本、布局、垃圾回收。

https://juejin.cn/post/6844903765682683911
https://juejin.cn/post/6844903765741404168
https://juejin.cn/post/6844903765749792782



# SSR

SSR是服务端渲染：在后台将vue实例渲染为HTML字符串直接返回，在前端激活为交互程序。

### 传统的服务端渲染

实现原理：

1. 客户端发送请求给服务器
2. 服务器查询数据库，使用视图、模板引擎等拼接成html字符串，返回给客户端
3. 客户端渲染html

优点：

1. 网页内容在服务器端渲染完成，一次性传输到浏览器，所以首屏加载速度非常快
2. 有利于SEO，因为服务器返回的是一个完整的html，在浏览器可以看到完整的dom，对于爬虫、百度搜索等引擎就比较友好

缺点：

1. 在后续跳转其它链接时，整个页面还要重复这样的操作，不断地请求响应、请求响应，相对来说，消耗的带宽资源、后续请求的时间就多了

### 单页应用SPA

单页应用其优秀的用户体验，使其逐渐成为主流，页面内容由js渲染出来，这种方式称为客户端渲染。它的过程是：

1. 客户端发送请求给服务器
2. 服务器返回html，但这时的html只有基本的结构（比如vue中，只有app这个div结构），没有其他具体的dom结构
3. 客户端渲染html，渲染执行js（比如vuejs），渲染模板template，这时候会再向服务器发送请求，请求具体的数据
4. 服务器查询数据库，返回对应的数据
5. 客户端渲染显示

缺点：

1. 网速很慢的时候，它的首屏等待时间较长
2. SEO不友好，暴露给搜索引擎只有最基本的html结构(比如：<div id="app"></div>)

### 现在流行的服务端渲染SSR

它是传统的服务端渲染和单页应用的一种折中的解决方案：后端渲染出完整的dom结构返回，前端拿到的内容包括：**首屏及完整spa结构**，应用激活后依然按照spa方式运行，这种页面渲染方式被称为服务端渲染（server side render），它的过程是：

1. 客户端发送请求给服务器
2. 服务器读取模板，解析成dom节点，返回一个完整的首屏html结构
3. 客户端进行首屏激活（把用户写的交互的代码，在前端激活，重新变成一个spa应用）
4. 这样后续，用户再点击超链接、跳转时，不会再向服务器发送请求了，而是使用前端路由跳转，只会发送一些ajax请求数据

**优点：**

- SEO友好
- 首屏加载快

**缺点：**

- 开发逻辑复杂
- 开发条件限制：比如一些生命周期不能用，一些第三方库也可能不能用
- 服务器负载大

# 图片优化

1. 选择合适的图片格式和压缩大图，可从根源上截图大图加载过慢的问题。
2. 使用雪碧图，iconfont，base64，css 代替图片等可减少图片 http 请求，提高页面加载速度。
3. 使用 CDN 图片可达到分流的效果，减少服务券压力。
4. 图片懒加载，预加载，渐进式图片等可不同程度减少白屏时间，提高产品体验。

**1、选择合适的图片格式**

- jpge
  - 有损压缩，24位（1600w种颜色）
  - 不支持透明度
- png
  - 无损压缩、8或24
  - 体积大
- gif
  - 无损，8位
- webp
  - 无损或有损
  - 兼容性不好（移动端ios不行
- 雪碧图（精灵图）
  - 一张图、改变位置显示图像
- base64
  - 省略http请求的时间，加密，方便引用
  - 图片大的话字符串太大

**2、方法**

- CDN
- 懒加载
- 预加载
- 响应式
  - CSS3的@media
  - H5的picture
- 渐进式

# 单页面SEO（搜索引擎优化

网络爬虫不会爬取异步资源，而单页面应用大部分是根据url的变化异步加载模块的，所以SEO不友好

**解决：**

1、预渲染：

打包生成一些主要路由对应的静态html文件，这样有了更多的静态资源，网络爬虫可以抓取到更多的网站信息，提升网站的搜索排名

2、SSR(服务端渲染)：

服务端渲染就是先向后端服务器请求数据，然后生成完整首屏html返回给浏览器，服务端渲染返回给客户端的是已经获取了异步数据并执行JavaScript脚本的最终HTML，网络爬虫可以抓取到完整的页面信息，SSR另一个很大的作用是加速首屏渲染，因为无需等待所有的JavaScript都完成下载并执行，才显示服务端渲染的标记，所以用户会更快地看到完整渲染的页面





















